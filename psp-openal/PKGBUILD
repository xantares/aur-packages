
pkgname=psp-openal
pkgver=1.14
pkgrel=1
pkgdesc="A cross-platform 3D audio library (psp)"
arch=('any')
url="http://www.openal.org/"
license=('LGPL')
depends=('psp-sdk' 'psp-pthreads-emb')
makedepends=('psp-gcc' 'psp-cmake' 'psp-pkg-config')
options=('staticlibs' '!buildflags' '!strip')
source=("http://kcat.strangesoft.net/openal-releases/openal-soft-$pkgver.tar.bz2")
md5sums=('SKIP')

prepare() {
  cd "$srcdir"/openal-soft-$pkgver
  
  # FIXME: -lc should be put after -lm, and libm is not detected
  sed -i "s|CHECK_LIBRARY_EXISTS(m pow|set(HAVE_LIBM TRUE)#CHECK_LIBRARY_EXISTS(m pow|g" CMakeLists.txt
}

build() {
  cd "$srcdir"/openal-soft-$pkgver 
  mkdir -p build-psp && pushd build-psp
  psp-cmake -DPKG_CONFIG_EXECUTABLE=/usr/psp/bin/pkg-config -DCMAKE_VERBOSE_MAKEFILE=1 ..
  make
}

package() {
  cd "$srcdir"/openal-soft-$pkgver
  make DESTDIR="$pkgdir" install
}
